(()=>{"use strict";const e="none",t={chrome:{range:{max:1,min:0},start:.8,step:.1},sepia:{range:{max:1,min:0},start:.8,step:.1},marvin:{range:{max:100,min:0},start:80,step:1},phobos:{range:{max:3,min:0},start:2.4,step:.1},heat:{range:{max:3,min:1},start:2.6,step:.1}},r="https://23.javascript.pages.academy/kekstagram",n=e=>{if(e.status<200||e.status>299)throw new Error(`Статус ответа ${e.status}: ${e.statusText}`);return e},o=e=>e.json(),c=(e=0,t=1)=>{const r=Math.ceil(Math.min(e,t)),n=Math.floor(Math.max(e,t));return Math.floor(r+Math.random()*(n-r+1))},i=e=>27===e,l=(e,t)=>t.comments.length-e.comments.length,s=document.querySelector("body"),a=()=>s.classList.add("scroll-lock"),u=()=>s.classList.remove("scroll-lock"),d=e=>e.classList.add("hidden"),m=e=>e.classList.remove("hidden"),y=e=>e.remove();let v=5,p=[];const _=document.querySelector("body").querySelector(".big-picture"),g=_.querySelector(".big-picture__img img"),h=_.querySelector(".social__caption"),f=_.querySelector(".likes-count"),S=_.querySelector(".social__comments"),q=_.querySelector(".big-picture__cancel"),L=_.querySelector(".social__comment-count"),E=_.querySelector(".social__comments-loader"),k=e=>{i(e.keyCode)&&C()},C=()=>{b()},w=e=>{e.preventDefault();const t=p.length,r=Math.min(t,v+5);x(v,r),v=r,t<=v&&V(),$()},b=()=>{u(),d(_),E.removeEventListener("click",w),q.removeEventListener("click",C),document.removeEventListener("keydown",k)},x=(e,t)=>{const r=document.createDocumentFragment();p.slice(e,t).forEach((e=>r.appendChild((e=>{const t=document.querySelector("#comment").content.querySelector(".social__comment").cloneNode(!0),r=t.querySelector(".social__picture"),n=t.querySelector(".social__text");return r.src=e.avatar,r.alt=e.name,n.textContent=e.message,t})(e)))),S.appendChild(r)},$=()=>{const e=p.length;L.textContent=`${v} из ${e} комментариев`},V=()=>{d(E),E.removeEventListener("click",w)},D=e=>{p=[...e.comments],g.src=e.url,h.textContent=e.description,f.textContent=e.likes,(()=>{const e=p.length;S.innerHTML="",x(0,5),e>5?(v=5,m(E),E.addEventListener("click",w)):(v=e,V()),$()})(),a(),m(_),q.addEventListener("click",C),document.addEventListener("keydown",k)},M=document.querySelector("#picture").content.querySelector(".picture"),U=e=>{D(e)},j=e=>{const t=M.cloneNode(!0);return t.querySelector(".picture__img").src=e.url,t.querySelector(".picture__likes").textContent=e.likes,t.querySelector(".picture__comments").textContent=e.comments.length,t.addEventListener("click",U.bind(null,e)),t},N=e=>{const t=document.createDocumentFragment(),r=document.querySelector(".pictures");document.querySelectorAll(".picture").forEach(y),e.forEach((e=>t.appendChild(j(e)))),r.appendChild(t)},A=document.querySelector(".img-filters"),F=A.querySelector(".img-filters__form");let O="filter-default",R=[];F.addEventListener("click",(e=>{e.preventDefault();const t=e.target.id;if(t!==O)switch(F.querySelector(`#${O}`).classList.remove("img-filters__button--active"),F.querySelector(`#${t}`).classList.add("img-filters__button--active"),O=t,O){case"filter-random":N((e=>{const t=[...e];for(let e=t.length-1;e>0;e--){const r=c(0,e),n=t[e];t[e]=t[r],t[r]=n}return t})(R));break;case"filter-discussed":N(R.slice().sort(l));break;default:N(R)}}));const T=document.querySelector(".img-upload__form"),z=T.querySelector(".img-upload__preview img"),I=T.querySelector(".effect-level__slider"),H=T.querySelector(".img-upload__effect-level"),P=T.querySelector(".effects__list"),W={[e]:()=>z.style.filter="none",chrome:e=>z.style.filter=`grayscale(${e})`,sepia:e=>z.style.filter=`sepia(${e})`,marvin:e=>z.style.filter=`invert(${e}%)`,phobos:e=>z.style.filter=`blur(${e}px)`,heat:e=>z.style.filter=`brightness(${e})`};let Z=e;const B=e=>{z.className="",z.classList.add(`effects__preview--${e}`)},G=()=>{I.noUiSlider&&I.noUiSlider.destroy()},J=r=>{return Z=r.target.value,B(Z),Z===e?(K(),void G()):I.noUiSlider?(n=Z,void I.noUiSlider.updateOptions(t[n])):((e=>{window.noUiSlider.create(I,Object.assign({},t[e],{connect:"lower"})),m(H)})(Z),void I.noUiSlider.on("update",((e,t)=>{const r=e[t];W[Z](r)})));var n},K=()=>{W.none(),B(e),d(H),G()},Q=document.querySelector(".img-upload__form"),X=Q.querySelector(".text__hashtags"),Y=Q.querySelector(".text__description"),ee=Q.querySelector(".img-upload__submit"),te=new RegExp("^#[A-Za-zА-Яа-я0-9]{1,19}$"),re=e=>{const t=e.target;if(!(e=>{const t=e.value.split(" ");if(t.length>5)return e.setCustomValidity("Максимальное количество хэш-тегов — 5"),!1;if(new Set(t).size!==t.length)return e.setCustomValidity("Хэштеги должны быть уникальными"),!1;for(const r of t){if(""===r)return e.setCustomValidity("Хэштеги разделяются пробелами"),!1;if("#"!==r[0])return e.setCustomValidity("Хэштег должен начинаться с #"),!1;if(r.length<2)return e.setCustomValidity("Минимальная длинна хэш-тега 2 символа"),!1;if(r.length>20)return e.setCustomValidity("Максимальная длинна хэш-тега 20 символа"),!1;if(!te.test(r))return e.setCustomValidity("Строка после # не может содержать спецсимволов"),!1}return!0})(t))return t.reportValidity(),void(ee.disabled=!0);t.setCustomValidity(""),ee.disabled=!1},ne=e=>{const t=e.target;if(((e,t)=>e.value.length>140&&(e.setCustomValidity("Максимальное количество символов — 140"),!0))(t))return t.reportValidity(),void(ee.disabled=!0);t.setCustomValidity(""),ee.disabled=!1},oe=document.querySelector(".img-upload__form"),ce=oe.querySelector(".scale__control--smaller"),ie=oe.querySelector(".scale__control--bigger"),le=oe.querySelector(".scale__control--value"),se=oe.querySelector(".img-upload__preview img"),ae=()=>{let e=parseInt(le.value,10);e>25&&(e-=25,se.style.width=`${e}%`,le.value=`${e}%`)},ue=()=>{let e=parseInt(le.value,10);e<100&&(e+=25,se.style.width=`${e}%`,le.value=`${e}%`)},de=document.querySelector("main"),me=document.querySelector("#success").content.querySelector(".success");let ye=null;const ve=e=>{i(e.keyCode)&&_e()},pe=e=>{e.preventDefault(),_e()},_e=()=>{y(ye),u(),document.removeEventListener("keydown",ve)},ge=document.querySelector("main"),he=document.querySelector("#error").content.querySelector(".error");let fe=null;const Se=e=>{i(e.keyCode)&&Le()},qe=e=>{e.preventDefault(),Le()},Le=()=>{y(fe),u(),document.removeEventListener("keydown",Se)},Ee=document.querySelector(".img-upload__form"),ke=Ee.querySelector(".img-upload__overlay"),Ce=Ee.querySelector(".img-upload__cancel"),we=e=>{i(e.keyCode)&&be()},be=()=>{De()},xe=()=>{(()=>{const e=(ye=me.cloneNode(!0),ye.querySelector(".success__button").addEventListener("click",pe),document.addEventListener("keydown",ve),ye);de.appendChild(e)})(),De()},$e=()=>{(()=>{const e=(fe=he.cloneNode(!0),fe.querySelectorAll(".error__button").forEach((e=>e.addEventListener("click",qe))),document.addEventListener("keydown",Se),fe);ge.appendChild(e)})(),De()},Ve=e=>{var t;e.preventDefault(),(t=new FormData(Ee),fetch(r,{method:"POST",body:t}).then(n).then(o)).then(xe).catch($e)},De=()=>{X.textContent="",Y.textContent="",K(),se.style.width="100%",le.value="100%",u(),d(ke),X.removeEventListener("input",re),Y.removeEventListener("input",ne),P.removeEventListener("change",J),ce.removeEventListener("click",ae),ie.removeEventListener("click",ue),Ce.removeEventListener("click",be),Ee.removeEventListener("submit",Ve),document.removeEventListener("keydown",we)},Me=["gif","jpg","jpeg","png"],Ue=document.querySelector(".img-upload__start input[type=file]"),je=document.querySelector(".img-upload__preview img");Ue.addEventListener("change",(e=>{const t=e.target.files[0],r=t.name.toLowerCase();if(Me.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{je.src=e.result,a(),m(ke),X.addEventListener("input",re),Y.addEventListener("input",ne),P.addEventListener("change",J),ce.addEventListener("click",ae),ie.addEventListener("click",ue),Ce.addEventListener("click",be),Ee.addEventListener("submit",Ve),document.addEventListener("keydown",we)})),e.readAsDataURL(t)}})),fetch(`${r}/data`).then(n).catch((e=>{throw e})).then(o).then((e=>{R=e,A.classList.remove("img-filters--inactive"),N(R)}))})();
//# sourceMappingURL=bundle.js.map